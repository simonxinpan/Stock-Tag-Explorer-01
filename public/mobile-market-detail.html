<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚åœºè¯¦æƒ… - è‚¡ç¥¨æ ‡ç­¾æ¢ç´¢å™¨</title>
    <link rel="stylesheet" href="styles/mobile-market-detail.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- çŠ¶æ€æ å ä½ -->
    <div class="status-bar"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- å›ºå®šé¡µé¦–å¯¼èˆªæ¡ -->
        <div class="fixed-header">
            <div class="header-card">
                <div class="header-line"></div>
                <div class="header-content">
                    <button class="back-btn" onclick="history.back()">
                        <span class="back-icon">â†</span>
                    </button>
                    <h1 class="header-title" id="page-title">å¸‚åœºè¯¦æƒ…</h1>
                    <div class="header-actions">
                        <button class="refresh-btn" onclick="loadMarketData()">
                            <span class="refresh-icon">â†»</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡µé¢å†…å®¹ -->
        <div class="page-content">
            <!-- å¸‚åœºæ¦‚è§ˆå¡ç‰‡ -->
            <div class="market-overview-card">
                <div class="overview-line"></div>
                <div class="overview-content">
                    <div class="overview-header">
                        <div class="market-icon" id="market-icon">ğŸ“Š</div>
                        <div class="market-info">
                            <h2 class="market-name" id="market-name">å¸‚åœºæ¦‚è§ˆ</h2>
                            <p class="market-desc" id="market-desc">å®æ—¶å¸‚åœºæ•°æ®</p>
                        </div>
                    </div>
                    <div class="overview-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="total-stocks">--</span>
                            <span class="stat-label">æ€»è‚¡ç¥¨æ•°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number positive" id="rising-stocks">--</span>
                            <span class="stat-label">ä¸Šæ¶¨</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number negative" id="falling-stocks">--</span>
                            <span class="stat-label">ä¸‹è·Œ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="total-market-cap">--</span>
                            <span class="stat-label">æ€»å¸‚å€¼</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¦œå•å¯¼èˆªå¡ç‰‡ -->
            <div class="ranking-nav-card">
                <div class="nav-line"></div>
                <div class="nav-content">
                    <h3 class="nav-title">ğŸ“ˆ è¶‹åŠ¿æ¦œå•</h3>
                    <div class="nav-grid">
                        <button class="nav-item" data-ranking="gainers">
                            <div class="nav-icon">ğŸ“ˆ</div>
                            <div class="nav-text">
                                <span class="nav-label">æ¶¨å¹…æ¦œ</span>
                                <span class="nav-desc">ä»Šæ—¥æ¶¨å¹…æœ€å¤§</span>
                            </div>
                            <div class="nav-arrow">â†’</div>
                        </button>
                        <button class="nav-item" data-ranking="losers">
                            <div class="nav-icon">ğŸ“‰</div>
                            <div class="nav-text">
                                <span class="nav-label">è·Œå¹…æ¦œ</span>
                                <span class="nav-desc">ä»Šæ—¥è·Œå¹…æœ€å¤§</span>
                            </div>
                            <div class="nav-arrow">â†’</div>
                        </button>
                        <button class="nav-item" data-ranking="marketcap">
                            <div class="nav-icon">ğŸ’°</div>
                            <div class="nav-text">
                                <span class="nav-label">å¸‚å€¼æ¦œ</span>
                                <span class="nav-desc">æŒ‰å¸‚å€¼æ’åº</span>
                            </div>
                            <div class="nav-arrow">â†’</div>
                        </button>
                        <button class="nav-item" data-ranking="volume">
                            <div class="nav-icon">ğŸ“Š</div>
                            <div class="nav-text">
                                <span class="nav-label">æˆäº¤é‡æ¦œ</span>
                                <span class="nav-desc">äº¤æ˜“æœ€æ´»è·ƒ</span>
                            </div>
                            <div class="nav-arrow">â†’</div>
                        </button>
                        <button class="nav-item" data-ranking="new-highs">
                            <div class="nav-icon">â¬†ï¸</div>
                            <div class="nav-text">
                                <span class="nav-label">åˆ›æ–°é«˜æ¦œ</span>
                                <span class="nav-desc">çªç ´å¹´å†…æ–°é«˜</span>
                            </div>
                            <div class="nav-arrow">â†’</div>
                        </button>
                        <button class="nav-item" data-ranking="momentum">
                            <div class="nav-icon">ğŸš€</div>
                            <div class="nav-text">
                                <span class="nav-label">åŠ¨é‡æ¦œ</span>
                                <span class="nav-desc">å¼ºåŠ¿ä¸Šæ¶¨è¶‹åŠ¿</span>
                            </div>
                            <div class="nav-arrow">â†’</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- çƒ­é—¨è‚¡ç¥¨é¢„è§ˆå¡ç‰‡ -->
            <div class="preview-card">
                <div class="preview-line"></div>
                <div class="preview-content">
                    <div class="preview-header">
                        <h3 class="preview-title">ğŸ”¥ çƒ­é—¨è‚¡ç¥¨</h3>
                        <button class="view-all-btn" onclick="viewAllStocks()">æŸ¥çœ‹å…¨éƒ¨</button>
                    </div>
                    
                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div id="loading-preview" class="loading-container">
                        <div class="loading-spinner"></div>
                        <p>åŠ è½½ä¸­...</p>
                    </div>

                    <!-- è‚¡ç¥¨é¢„è§ˆåˆ—è¡¨ -->
                    <div id="preview-list" class="preview-list hidden"></div>

                    <!-- é”™è¯¯çŠ¶æ€ -->
                    <div id="error-preview" class="error-container hidden">
                        <div class="error-icon">âš ï¸</div>
                        <p class="error-message">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p>
                        <button class="retry-btn" onclick="loadMarketData()">é‡æ–°åŠ è½½</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div id="toast" class="toast"></div>

    <script>
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // æ˜¾ç¤ºToastæ¶ˆæ¯
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toString();
        }

        // æ ¼å¼åŒ–ç™¾åˆ†æ¯”
        function formatPercentage(num) {
            return (num >= 0 ? '+' : '') + num.toFixed(2) + '%';
        }

        // åˆ›å»ºè‚¡ç¥¨é¢„è§ˆé¡¹
        function createPreviewItem(stock, index) {
            const changeClass = stock.change >= 0 ? 'positive' : 'negative';
            return `
                <div class="preview-item" onclick="viewStockDetail('${stock.symbol}')">
                    <div class="preview-rank">${index + 1}</div>
                    <div class="preview-info">
                        <div class="preview-symbol">${stock.symbol}</div>
                        <div class="preview-name">${stock.name}</div>
                    </div>
                    <div class="preview-price">
                        <div class="preview-current">$${stock.price.toFixed(2)}</div>
                        <div class="preview-change ${changeClass}">
                            ${formatPercentage(stock.change)}
                        </div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½å¸‚åœºæ•°æ®
        async function loadMarketData() {
            const market = getUrlParameter('market');
            if (!market) {
                showToast('ç¼ºå°‘å¸‚åœºå‚æ•°', 'error');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading-preview').classList.remove('hidden');
            document.getElementById('error-preview').classList.add('hidden');
            document.getElementById('preview-list').classList.add('hidden');

            try {
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ ¹æ®å¸‚åœºç±»å‹è®¾ç½®é¡µé¢ä¿¡æ¯
                const marketConfig = {
                    'sp500': {
                        name: 'æ ‡æ™®500',
                        desc: 'S&P 500æŒ‡æ•°æˆåˆ†è‚¡',
                        icon: 'ğŸ‡ºğŸ‡¸',
                        totalStocks: 502,
                        risingStocks: 326,
                        fallingStocks: 163,
                        totalMarketCap: '$45.2T'
                    },
                    'chinese_stocks': {
                        name: 'ä¸­æ¦‚è‚¡',
                        desc: 'åœ¨ç¾ä¸Šå¸‚ä¸­å›½å…¬å¸',
                        icon: 'ğŸ‡¨ğŸ‡³',
                        totalStocks: 55,
                        risingStocks: 32,
                        fallingStocks: 18,
                        totalMarketCap: '$2.8T'
                    }
                };

                const config = marketConfig[market] || marketConfig['sp500'];
                
                // æ›´æ–°é¡µé¢ä¿¡æ¯
                document.getElementById('page-title').textContent = config.name;
                document.getElementById('market-icon').textContent = config.icon;
                document.getElementById('market-name').textContent = config.name;
                document.getElementById('market-desc').textContent = config.desc;
                document.getElementById('total-stocks').textContent = config.totalStocks;
                document.getElementById('rising-stocks').textContent = config.risingStocks;
                document.getElementById('falling-stocks').textContent = config.fallingStocks;
                document.getElementById('total-market-cap').textContent = config.totalMarketCap;

                // ç”Ÿæˆæ¨¡æ‹Ÿè‚¡ç¥¨æ•°æ®
                const mockStocks = generateMockStocks(market, 5);
                
                // æ¸²æŸ“è‚¡ç¥¨é¢„è§ˆåˆ—è¡¨
                const previewHtml = mockStocks.map((stock, index) => createPreviewItem(stock, index)).join('');
                document.getElementById('preview-list').innerHTML = previewHtml;

                // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºåˆ—è¡¨
                document.getElementById('loading-preview').classList.add('hidden');
                document.getElementById('preview-list').classList.remove('hidden');

            } catch (error) {
                console.error('åŠ è½½å¸‚åœºæ•°æ®å¤±è´¥:', error);
                document.getElementById('loading-preview').classList.add('hidden');
                document.getElementById('error-preview').classList.remove('hidden');
                showToast('åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿè‚¡ç¥¨æ•°æ®
        function generateMockStocks(market, count) {
            const sp500Stocks = [
                { symbol: 'AAPL', name: 'è‹¹æœ' },
                { symbol: 'MSFT', name: 'å¾®è½¯' },
                { symbol: 'GOOGL', name: 'è°·æ­Œ' },
                { symbol: 'AMZN', name: 'äºšé©¬é€Š' },
                { symbol: 'TSLA', name: 'ç‰¹æ–¯æ‹‰' }
            ];
            
            const chineseStocks = [
                { symbol: 'BABA', name: 'é˜¿é‡Œå·´å·´' },
                { symbol: 'JD', name: 'äº¬ä¸œ' },
                { symbol: 'PDD', name: 'æ‹¼å¤šå¤š' },
                { symbol: 'BIDU', name: 'ç™¾åº¦' },
                { symbol: 'NIO', name: 'è”šæ¥' }
            ];
            
            const stockList = market === 'chinese_stocks' ? chineseStocks : sp500Stocks;
            
            return stockList.slice(0, count).map(stock => ({
                ...stock,
                price: 100 + Math.random() * 400,
                change: (Math.random() - 0.5) * 20
            }));
        }

        // æŸ¥çœ‹è‚¡ç¥¨è¯¦æƒ…
        function viewStockDetail(symbol) {
            showToast(`æŸ¥çœ‹ ${symbol} è¯¦æƒ…`, 'info');
            // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°è‚¡ç¥¨è¯¦æƒ…é¡µé¢
        }

        // æŸ¥çœ‹å…¨éƒ¨è‚¡ç¥¨
        function viewAllStocks() {
            const market = getUrlParameter('market');
            window.location.href = `mobile-ranking-detail.html?type=all&market=${market}`;
        }

        // æ¦œå•å¯¼èˆªäº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // æ¦œå•å¯¼èˆªæŒ‰é’®
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const ranking = this.getAttribute('data-ranking');
                    const market = getUrlParameter('market');
                    
                    // è·³è½¬åˆ°å…·ä½“æ¦œå•çš„ä¸‰çº§é¡µé¢
                    window.location.href = `mobile-ranking-detail.html?type=${ranking}&market=${market}`;
                });
            });

            // é¡µé¢åˆå§‹åŒ–
            loadMarketData();
        });
    </script>
</body>
</html>