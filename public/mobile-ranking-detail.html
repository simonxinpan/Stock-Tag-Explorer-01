<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê¶úÂçïËØ¶ÊÉÖ - ËÇ°Á•®Ê†áÁ≠æÊé¢Á¥¢Âô®</title>
    <link rel="stylesheet" href="styles/mobile-ranking-detail.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Áä∂ÊÄÅÊ†èÂç†‰Ωç -->
    <div class="status-bar"></div>
    
    <!-- ‰∏ªÂÆπÂô® -->
    <div class="main-container">
        <!-- Âõ∫ÂÆöÈ°µÈ¶ñÂØºËà™Êù° -->
        <div class="fixed-header">
            <div class="header-card">
                <div class="header-line"></div>
                <div class="header-content">
                    <button class="back-btn" onclick="history.back()">
                        <span class="back-icon">‚Üê</span>
                    </button>
                    <h1 class="header-title" id="page-title">Ê¶úÂçïËØ¶ÊÉÖ</h1>
                    <div class="header-actions">
                        <button class="refresh-btn" onclick="loadRankingData()">
                            <span class="refresh-icon">‚Üª</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- È°µÈù¢ÂÜÖÂÆπ -->
        <div class="page-content">
            <!-- Ê¶úÂçïÁªüËÆ°Âç°Áâá -->
            <div class="stats-card">
                <div class="stats-line"></div>
                <div class="stats-content">
                    <div class="stat-item">
                        <span class="stat-icon" id="stat-icon">üìà</span>
                        <div class="stat-info">
                            <span class="stat-number" id="stat-number">--</span>
                            <span class="stat-label" id="stat-label">ËÇ°Á•®Êï∞Èáè</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üìä</span>
                        <div class="stat-info">
                            <span class="stat-number" id="avg-change">--</span>
                            <span class="stat-label">Âπ≥ÂùáÊ∂®Ë∑åÂπÖ</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üí∞</span>
                        <div class="stat-info">
                            <span class="stat-number" id="total-value">--</span>
                            <span class="stat-label">ÊÄªÂ∏ÇÂÄº</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÊéíÂ∫èÁ≠õÈÄâÂç°Áâá -->
            <div class="filter-card">
                <div class="filter-line"></div>
                <div class="filter-content">
                    <div class="filter-group">
                        <label class="filter-label">ÊéíÂ∫èÊñπÂºè</label>
                        <select class="filter-select" id="sort-select">
                            <option value="change_desc">Ê∂®Ë∑åÂπÖ ‚Üì</option>
                            <option value="change_asc">Ê∂®Ë∑åÂπÖ ‚Üë</option>
                            <option value="market_cap_desc">Â∏ÇÂÄº ‚Üì</option>
                            <option value="market_cap_asc">Â∏ÇÂÄº ‚Üë</option>
                            <option value="volume_desc">Êàê‰∫§Èáè ‚Üì</option>
                            <option value="volume_asc">Êàê‰∫§Èáè ‚Üë</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Â∏ÇÂú∫</label>
                        <select class="filter-select" id="market-select">
                            <option value="all">ÂÖ®ÈÉ®Â∏ÇÂú∫</option>
                            <option value="sp500">Ê†áÊôÆ500</option>
                            <option value="chinese">‰∏≠Ê¶ÇËÇ°</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ËÇ°Á•®ÂàóË°®Âç°Áâá -->
            <div class="stock-list-card">
                <div class="stock-list-line"></div>
                <div class="stock-list-content">
                    <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
                    <div id="loading-state" class="loading-container">
                        <div class="loading-spinner"></div>
                        <p>Âä†ËΩΩ‰∏≠...</p>
                    </div>

                    <!-- ÈîôËØØÁä∂ÊÄÅ -->
                    <div id="error-state" class="error-container hidden">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <p class="error-message">Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</p>
                        <button class="retry-btn" onclick="loadRankingData()">ÈáçÊñ∞Âä†ËΩΩ</button>
                    </div>

                    <!-- ËÇ°Á•®ÂàóË°® -->
                    <div id="stock-list" class="stock-list hidden"></div>

                    <!-- Á©∫Áä∂ÊÄÅ -->
                    <div id="empty-state" class="empty-container hidden">
                        <div class="empty-icon">üìä</div>
                        <p class="empty-message">ÊöÇÊó†Êï∞ÊçÆ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast ÈÄöÁü• -->
    <div id="toast" class="toast"></div>

    <script>
        // Ëé∑ÂèñURLÂèÇÊï∞
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // ÊòæÁ§∫ToastÊ∂àÊÅØ
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        // Ê†ºÂºèÂåñÊï∞Â≠ó
        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toString();
        }

        // Ê†ºÂºèÂåñÁôæÂàÜÊØî
        function formatPercentage(num) {
            return (num >= 0 ? '+' : '') + num.toFixed(2) + '%';
        }

        // ÂàõÂª∫ËÇ°Á•®È°πHTML
        function createStockItem(stock, index) {
            const changeClass = stock.change >= 0 ? 'positive' : 'negative';
            return `
                <div class="stock-item" onclick="viewStockDetail('${stock.symbol}')">
                    <div class="stock-rank">${index + 1}</div>
                    <div class="stock-info">
                        <div class="stock-symbol">${stock.symbol}</div>
                        <div class="stock-name">${stock.name}</div>
                    </div>
                    <div class="stock-price">
                        <div class="current-price">$${stock.price.toFixed(2)}</div>
                        <div class="price-change ${changeClass}">
                            ${formatPercentage(stock.change)}
                        </div>
                    </div>
                </div>
            `;
        }

        // Âä†ËΩΩÊ¶úÂçïÊï∞ÊçÆ
        async function loadRankingData() {
            const rankingType = getUrlParameter('type');
            const market = getUrlParameter('market') || 'sp500';
            
            if (!rankingType) {
                showToast('Áº∫Â∞ëÊ¶úÂçïÁ±ªÂûãÂèÇÊï∞', 'error');
                return;
            }

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('stock-list').classList.add('hidden');
            document.getElementById('empty-state').classList.add('hidden');

            try {
                // Ê®°ÊãüAPIË∞ÉÁî®
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Ê†πÊçÆÊ¶úÂçïÁ±ªÂûãÂíåÂ∏ÇÂú∫ËÆæÁΩÆÈ°µÈù¢Ê†áÈ¢òÂíåÂõæÊ†á
                const rankingConfig = {
                    'gainers': { title: 'Ê∂®ÂπÖÊ¶ú', icon: 'üìà', label: '‰∏äÊ∂®ËÇ°Á•®' },
                    'losers': { title: 'Ë∑åÂπÖÊ¶ú', icon: 'üìâ', label: '‰∏ãË∑åËÇ°Á•®' },
                    'marketcap': { title: 'Â∏ÇÂÄºÊ¶ú', icon: 'üí∞', label: 'Â§ßÂ∏ÇÂÄºËÇ°Á•®' },
                    'volume': { title: 'Êàê‰∫§ÈáèÊ¶ú', icon: 'üìä', label: 'Ê¥ªË∑ÉËÇ°Á•®' },
                    'new-highs': { title: 'ÂàõÊñ∞È´òÊ¶ú', icon: '‚¨ÜÔ∏è', label: 'ÂàõÊñ∞È´òËÇ°Á•®' },
                    'momentum': { title: 'Âä®ÈáèÊ¶ú', icon: 'üöÄ', label: 'Âº∫ÂäøËÇ°Á•®' },
                    'all': { title: 'ÂÖ®ÈÉ®ËÇ°Á•®', icon: 'üìä', label: 'ÊâÄÊúâËÇ°Á•®' }
                };
                
                const marketNames = {
                    'sp500': 'Ê†áÊôÆ500',
                    'chinese_stocks': '‰∏≠Ê¶ÇËÇ°'
                };

                const config = rankingConfig[rankingType] || { title: 'Ê¶úÂçïËØ¶ÊÉÖ', icon: 'üìä', label: 'ËÇ°Á•®' };
                const marketName = marketNames[market] || 'ÂÖ®Â∏ÇÂú∫';
                
                document.getElementById('page-title').textContent = `${marketName} ${config.title}`;
                document.getElementById('stat-icon').textContent = config.icon;
                document.getElementById('stat-label').textContent = config.label;

                // Ê®°ÊãüËÇ°Á•®Êï∞ÊçÆ
                const mockStocks = generateMockStocks(rankingType, market, 50);
                
                // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
                document.getElementById('stat-number').textContent = mockStocks.length;
                const avgChange = mockStocks.reduce((sum, stock) => sum + stock.change, 0) / mockStocks.length;
                document.getElementById('avg-change').textContent = formatPercentage(avgChange);
                const totalValue = mockStocks.reduce((sum, stock) => sum + stock.marketCap, 0);
                document.getElementById('total-value').textContent = '$' + formatNumber(totalValue);

                // Ê∏≤ÊüìËÇ°Á•®ÂàóË°®
                const stockListHtml = mockStocks.map((stock, index) => createStockItem(stock, index)).join('');
                document.getElementById('stock-list').innerHTML = stockListHtml;

                // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅÔºåÊòæÁ§∫ÂàóË°®
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('stock-list').classList.remove('hidden');

            } catch (error) {
                console.error('Âä†ËΩΩÊ¶úÂçïÊï∞ÊçÆÂ§±Ë¥•:', error);
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('error-state').classList.remove('hidden');
                showToast('Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');
            }
        }

        // ÁîüÊàêÊ®°ÊãüËÇ°Á•®Êï∞ÊçÆ
        function generateMockStocks(type, market, count) {
            const sp500Stocks = {
                symbols: ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'META', 'NVDA', 'NFLX', 'AMD', 'CRM', 'ORCL', 'ADBE'],
                names: ['ËãπÊûú', 'ÂæÆËΩØ', 'Ë∞∑Ê≠å', '‰∫öÈ©¨ÈÄä', 'ÁâπÊñØÊãâ', 'Meta', 'Ëã±‰ºüËææ', 'Â•àÈ£û', 'AMD', 'Salesforce', 'Áî≤È™®Êñá', 'Adobe']
            };
            
            const chineseStocks = {
                symbols: ['BABA', 'JD', 'PDD', 'BIDU', 'NIO', 'XPEV', 'LI', 'BILI', 'TME', 'NTES', 'WB', 'DIDI'],
                names: ['ÈòøÈáåÂ∑¥Â∑¥', '‰∫¨‰∏ú', 'ÊãºÂ§öÂ§ö', 'ÁôæÂ∫¶', 'ËîöÊù•', 'Â∞èÈπè', 'ÁêÜÊÉ≥', 'ÂìîÂì©ÂìîÂì©', 'ËÖæËÆØÈü≥‰πê', 'ÁΩëÊòì', 'ÂæÆÂçö', 'Êª¥Êª¥']
            };
            
            const stockData = market === 'chinese_stocks' ? chineseStocks : sp500Stocks;
            const { symbols, names } = stockData;
            
            const stocks = [];
            for (let i = 0; i < count; i++) {
                const symbolIndex = i % symbols.length;
                const baseChange = type === 'gainers' ? Math.random() * 15 : 
                                 type === 'losers' ? -Math.random() * 15 : 
                                 (Math.random() - 0.5) * 20;
                
                stocks.push({
                    symbol: symbols[symbolIndex] + (i > symbols.length - 1 ? i : ''),
                    name: names[symbolIndex] + (i > names.length - 1 ? i : ''),
                    price: 100 + Math.random() * 400,
                    change: baseChange,
                    marketCap: (Math.random() * 2000 + 100) * 1e9
                });
            }
            
            // Ê†πÊçÆÁ±ªÂûãÊéíÂ∫è
            if (type === 'gainers') {
                stocks.sort((a, b) => b.change - a.change);
            } else if (type === 'losers') {
                stocks.sort((a, b) => a.change - b.change);
            } else if (type === 'marketcap') {
                stocks.sort((a, b) => b.marketCap - a.marketCap);
            }
            
            return stocks;
        }

        // Êü•ÁúãËÇ°Á•®ËØ¶ÊÉÖ
        function viewStockDetail(symbol) {
            showToast(`Êü•Áúã ${symbol} ËØ¶ÊÉÖ`, 'info');
            // ËøôÈáåÂèØ‰ª•Ë∑≥ËΩ¨Âà∞ËÇ°Á•®ËØ¶ÊÉÖÈ°µÈù¢
        }

        // ÊéíÂ∫èÂíåÁ≠õÈÄâ‰∫ã‰ª∂ÁõëÂê¨
        document.addEventListener('DOMContentLoaded', function() {
            // ÊéíÂ∫èÈÄâÊã©ÂèòÂåñ
            document.getElementById('sort-select').addEventListener('change', function() {
                showToast('ÈáçÊñ∞ÊéíÂ∫è‰∏≠...', 'info');
                setTimeout(() => loadRankingData(), 500);
            });

            // Â∏ÇÂú∫Á≠õÈÄâÂèòÂåñ
            document.getElementById('market-select').addEventListener('change', function() {
                showToast('Á≠õÈÄâ‰∏≠...', 'info');
                setTimeout(() => loadRankingData(), 500);
            });

            // È°µÈù¢ÂàùÂßãÂåñ
            loadRankingData();
        });
    </script>
</body>
</html>