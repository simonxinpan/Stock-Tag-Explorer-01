<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¦œå•è¯¦æƒ… - è‚¡ç¥¨æ ‡ç­¾æ¢ç´¢å™¨</title>
    <link rel="stylesheet" href="styles/mobile-ranking-detail.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- çŠ¶æ€æ å ä½ -->
    <div class="status-bar"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- å›ºå®šé¡µé¦–å¯¼èˆªæ¡ -->
        <div class="fixed-header">
            <div class="header-card">
                <div class="header-line"></div>
                <div class="header-content">
                    <button class="back-btn" onclick="history.back()">
                        <span class="back-icon">â†</span>
                    </button>
                    <h1 class="header-title" id="page-title">æ¦œå•è¯¦æƒ…</h1>
                    <div class="header-actions">
                        <button class="refresh-btn" onclick="loadRankingData()">
                            <span class="refresh-icon">â†»</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡µé¢å†…å®¹ -->
        <div class="page-content">
            <!-- æ¦œå•ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-card">
                <div class="stats-line"></div>
                <div class="stats-content">
                    <div class="stat-item">
                        <span class="stat-icon" id="stat-icon">ğŸ“ˆ</span>
                        <div class="stat-info">
                            <span class="stat-number" id="stat-number">--</span>
                            <span class="stat-label" id="stat-label">è‚¡ç¥¨æ•°é‡</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ“Š</span>
                        <div class="stat-info">
                            <span class="stat-number" id="avg-change">--</span>
                            <span class="stat-label">å¹³å‡æ¶¨è·Œå¹…</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ’°</span>
                        <div class="stat-info">
                            <span class="stat-number" id="total-value">--</span>
                            <span class="stat-label">æ€»å¸‚å€¼</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ’åºç­›é€‰å¡ç‰‡ -->
            <div class="filter-card">
                <div class="filter-line"></div>
                <div class="filter-content">
                    <div class="filter-group">
                        <label class="filter-label">æ’åºæ–¹å¼</label>
                        <select class="filter-select" id="sort-select">
                            <option value="change_desc">æ¶¨è·Œå¹… â†“</option>
                            <option value="change_asc">æ¶¨è·Œå¹… â†‘</option>
                            <option value="market_cap_desc">å¸‚å€¼ â†“</option>
                            <option value="market_cap_asc">å¸‚å€¼ â†‘</option>
                            <option value="volume_desc">æˆäº¤é‡ â†“</option>
                            <option value="volume_asc">æˆäº¤é‡ â†‘</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">å¸‚åœº</label>
                        <select class="filter-select" id="market-select">
                            <option value="all">å…¨éƒ¨å¸‚åœº</option>
                            <option value="sp500">æ ‡æ™®500</option>
                            <option value="chinese">ä¸­æ¦‚è‚¡</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- è‚¡ç¥¨åˆ—è¡¨å¡ç‰‡ -->
            <div class="stock-list-card">
                <div class="stock-list-line"></div>
                <div class="stock-list-content">
                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div id="loading-state" class="loading-container">
                        <div class="loading-spinner"></div>
                        <p>åŠ è½½ä¸­...</p>
                    </div>

                    <!-- é”™è¯¯çŠ¶æ€ -->
                    <div id="error-state" class="error-container hidden">
                        <div class="error-icon">âš ï¸</div>
                        <p class="error-message">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p>
                        <button class="retry-btn" onclick="loadRankingData()">é‡æ–°åŠ è½½</button>
                    </div>

                    <!-- è‚¡ç¥¨åˆ—è¡¨ -->
                    <div id="stock-list" class="stock-list hidden"></div>

                    <!-- ç©ºçŠ¶æ€ -->
                    <div id="empty-state" class="empty-container hidden">
                        <div class="empty-icon">ğŸ“Š</div>
                        <p class="empty-message">æš‚æ— æ•°æ®</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div id="toast" class="toast"></div>

    <script>
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // æ˜¾ç¤ºToastæ¶ˆæ¯
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toString();
        }

        // æ ¼å¼åŒ–ç™¾åˆ†æ¯”
        function formatPercentage(num) {
            return (num >= 0 ? '+' : '') + num.toFixed(2) + '%';
        }

        // åˆ›å»ºè‚¡ç¥¨é¡¹HTML
        function createStockItem(stock, index) {
            const changeClass = stock.change >= 0 ? 'positive' : 'negative';
            return `
                <div class="stock-item" onclick="viewStockDetail('${stock.symbol}')">
                    <div class="stock-rank">${index + 1}</div>
                    <div class="stock-info">
                        <div class="stock-symbol">${stock.symbol}</div>
                        <div class="stock-name">${stock.name}</div>
                    </div>
                    <div class="stock-price">
                        <div class="current-price">$${stock.price.toFixed(2)}</div>
                        <div class="price-change ${changeClass}">
                            ${formatPercentage(stock.change)}
                        </div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½æ¦œå•æ•°æ®
        async function loadRankingData() {
            const rankingType = getUrlParameter('type');
            const market = getUrlParameter('market') || 'sp500';
            
            if (!rankingType) {
                showToast('ç¼ºå°‘æ¦œå•ç±»å‹å‚æ•°', 'error');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('stock-list').classList.add('hidden');
            document.getElementById('empty-state').classList.add('hidden');

            try {
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ ¹æ®æ¦œå•ç±»å‹å’Œå¸‚åœºè®¾ç½®é¡µé¢æ ‡é¢˜å’Œå›¾æ ‡
                const rankingConfig = {
                    'gainers': { title: 'æ¶¨å¹…æ¦œ', icon: 'ğŸ“ˆ', label: 'ä¸Šæ¶¨è‚¡ç¥¨' },
                    'losers': { title: 'è·Œå¹…æ¦œ', icon: 'ğŸ“‰', label: 'ä¸‹è·Œè‚¡ç¥¨' },
                    'marketcap': { title: 'å¸‚å€¼æ¦œ', icon: 'ğŸ’°', label: 'å¤§å¸‚å€¼è‚¡ç¥¨' },
                    'volume': { title: 'æˆäº¤é‡æ¦œ', icon: 'ğŸ“Š', label: 'æ´»è·ƒè‚¡ç¥¨' },
                    'new-highs': { title: 'åˆ›æ–°é«˜æ¦œ', icon: 'â¬†ï¸', label: 'åˆ›æ–°é«˜è‚¡ç¥¨' },
                    'momentum': { title: 'åŠ¨é‡æ¦œ', icon: 'ğŸš€', label: 'å¼ºåŠ¿è‚¡ç¥¨' },
                    'all': { title: 'å…¨éƒ¨è‚¡ç¥¨', icon: 'ğŸ“Š', label: 'æ‰€æœ‰è‚¡ç¥¨' }
                };
                
                const marketNames = {
                    'sp500': 'æ ‡æ™®500',
                    'chinese_stocks': 'ä¸­æ¦‚è‚¡'
                };

                const config = rankingConfig[rankingType] || { title: 'æ¦œå•è¯¦æƒ…', icon: 'ğŸ“Š', label: 'è‚¡ç¥¨' };
                const marketName = marketNames[market] || 'å…¨å¸‚åœº';
                
                document.getElementById('page-title').textContent = `${marketName} ${config.title}`;
                document.getElementById('stat-icon').textContent = config.icon;
                document.getElementById('stat-label').textContent = config.label;

                // æ¨¡æ‹Ÿè‚¡ç¥¨æ•°æ®
                const mockStocks = generateMockStocks(rankingType, market, 50);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                document.getElementById('stat-number').textContent = mockStocks.length;
                const avgChange = mockStocks.reduce((sum, stock) => sum + stock.change, 0) / mockStocks.length;
                document.getElementById('avg-change').textContent = formatPercentage(avgChange);
                const totalValue = mockStocks.reduce((sum, stock) => sum + stock.marketCap, 0);
                document.getElementById('total-value').textContent = '$' + formatNumber(totalValue);

                // æ¸²æŸ“è‚¡ç¥¨åˆ—è¡¨
                const stockListHtml = mockStocks.map((stock, index) => createStockItem(stock, index)).join('');
                document.getElementById('stock-list').innerHTML = stockListHtml;

                // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºåˆ—è¡¨
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('stock-list').classList.remove('hidden');

            } catch (error) {
                console.error('åŠ è½½æ¦œå•æ•°æ®å¤±è´¥:', error);
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('error-state').classList.remove('hidden');
                showToast('åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿè‚¡ç¥¨æ•°æ®
        function generateMockStocks(type, market, count) {
            const sp500Stocks = {
                symbols: ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'META', 'NVDA', 'NFLX', 'AMD', 'CRM', 'ORCL', 'ADBE'],
                names: ['è‹¹æœ', 'å¾®è½¯', 'è°·æ­Œ', 'äºšé©¬é€Š', 'ç‰¹æ–¯æ‹‰', 'Meta', 'è‹±ä¼Ÿè¾¾', 'å¥ˆé£', 'AMD', 'Salesforce', 'ç”²éª¨æ–‡', 'Adobe']
            };
            
            const chineseStocks = {
                symbols: ['BABA', 'JD', 'PDD', 'BIDU', 'NIO', 'XPEV', 'LI', 'BILI', 'TME', 'NTES', 'WB', 'DIDI'],
                names: ['é˜¿é‡Œå·´å·´', 'äº¬ä¸œ', 'æ‹¼å¤šå¤š', 'ç™¾åº¦', 'è”šæ¥', 'å°é¹', 'ç†æƒ³', 'å“”å“©å“”å“©', 'è…¾è®¯éŸ³ä¹', 'ç½‘æ˜“', 'å¾®åš', 'æ»´æ»´']
            };
            
            const stockData = market === 'chinese_stocks' ? chineseStocks : sp500Stocks;
            const { symbols, names } = stockData;
            
            const stocks = [];
            for (let i = 0; i < count; i++) {
                const symbolIndex = i % symbols.length;
                const baseChange = type === 'gainers' ? Math.random() * 15 : 
                                 type === 'losers' ? -Math.random() * 15 : 
                                 (Math.random() - 0.5) * 20;
                
                stocks.push({
                    symbol: symbols[symbolIndex] + (i > symbols.length - 1 ? i : ''),
                    name: names[symbolIndex] + (i > names.length - 1 ? i : ''),
                    price: 100 + Math.random() * 400,
                    change: baseChange,
                    marketCap: (Math.random() * 2000 + 100) * 1e9
                });
            }
            
            // æ ¹æ®ç±»å‹æ’åº
            if (type === 'gainers') {
                stocks.sort((a, b) => b.change - a.change);
            } else if (type === 'losers') {
                stocks.sort((a, b) => a.change - b.change);
            } else if (type === 'marketcap') {
                stocks.sort((a, b) => b.marketCap - a.marketCap);
            }
            
            return stocks;
        }

        // æŸ¥çœ‹è‚¡ç¥¨è¯¦æƒ…
        function viewStockDetail(symbol) {
            showToast(`æŸ¥çœ‹ ${symbol} è¯¦æƒ…`, 'info');
            // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°è‚¡ç¥¨è¯¦æƒ…é¡µé¢
        }

        // æ’åºå’Œç­›é€‰äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', function() {
            // æ’åºé€‰æ‹©å˜åŒ–
            document.getElementById('sort-select').addEventListener('change', function() {
                showToast('é‡æ–°æ’åºä¸­...', 'info');
                setTimeout(() => loadRankingData(), 500);
            });

            // å¸‚åœºç­›é€‰å˜åŒ–
            document.getElementById('market-select').addEventListener('change', function() {
                showToast('ç­›é€‰ä¸­...', 'info');
                setTimeout(() => loadRankingData(), 500);
            });

            // é¡µé¢åˆå§‹åŒ–
            loadRankingData();
        });
    </script>
</body>
</html>