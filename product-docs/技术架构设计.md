# é›†æˆå¼çƒ­åŠ›å›¾ä½“éªŒ - æŠ€æœ¯æ¶æ„è®¾è®¡

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**è´Ÿè´£äºº**: PM-Core  
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ30æ—¥  
**å…³è”æ–‡æ¡£**: é›†æˆå¼çƒ­åŠ›å›¾ä½“éªŒ-PRD.md

---

## 1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Stock Tag Explorer ä¸»åº”ç”¨                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ‡ç­¾å¹¿åœº        â”‚  è¶‹åŠ¿æ¦œå•        â”‚  çƒ­åŠ›å›¾ä¸­å¿ƒ        â”‚
â”‚  (index.html)   â”‚  (trending.html) â”‚  (heatmap-center) â”‚
â”‚                 â”‚                 â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ ‡ç­¾è¯¦æƒ…é¡µ   â”‚ â”‚  â”‚ æ¦œå•çƒ­åŠ›å›¾   â”‚ â”‚  â”‚ æ±‡æ€»å¯¼èˆª     â”‚  â”‚
â”‚  â”‚ + çƒ­åŠ›å›¾    â”‚ â”‚  â”‚ (è¿·ä½ ç‰ˆ)    â”‚ â”‚  â”‚ + å…¨æ™¯é“¾æ¥   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   StockHeatmap æ ¸å¿ƒç»„ä»¶                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å¤„ç†å™¨      â”‚  æ¸²æŸ“å¼•æ“        â”‚  äº¤äº’æ§åˆ¶å™¨        â”‚
â”‚  DataProcessor  â”‚  HeatmapRenderer â”‚  InteractionHandler â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç°æœ‰APIå±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /api/stocks-by-tag  â”‚  /api/trending  â”‚  /api/tags        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **ç»„ä»¶åŒ–**: çƒ­åŠ›å›¾åŠŸèƒ½å°è£…ä¸ºå¯å¤ç”¨ç»„ä»¶
- **æ¸è¿›å¢å¼º**: åœ¨ç°æœ‰åŠŸèƒ½åŸºç¡€ä¸Šå¢åŠ çƒ­åŠ›å›¾ï¼Œä¸ç ´ååŸæœ‰ä½“éªŒ
- **æ€§èƒ½ä¼˜å…ˆ**: ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ï¼Œæ”¯æŒå¤šå®ä¾‹å¹¶å­˜
- **æ•°æ®é©±åŠ¨**: åŸºäºç°æœ‰APIæ•°æ®ï¼Œæ— éœ€é¢å¤–åç«¯å¼€å‘

---

## 2. æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 2.1 StockHeatmap ä¸»ç»„ä»¶

#### ç»„ä»¶æ¥å£è®¾è®¡
```javascript
class StockHeatmap {
  constructor(options) {
    this.container = options.container;     // DOMå®¹å™¨é€‰æ‹©å™¨
    this.data = options.data || [];         // è‚¡ç¥¨æ•°æ®æ•°ç»„
    this.config = {
      width: options.width || 'auto',       // å®½åº¦
      height: options.height || 400,        // é«˜åº¦
      colorScheme: options.colorScheme || 'redGreen', // é¢œè‰²æ–¹æ¡ˆ
      showLabels: options.showLabels !== false,       // æ˜¾ç¤ºæ ‡ç­¾
      interactive: options.interactive !== false,     // äº¤äº’åŠŸèƒ½
      groupBy: options.groupBy || 'sector',           // åˆ†ç»„æ–¹å¼
      ...options.config
    };
    this.callbacks = options.callbacks || {}; // äº‹ä»¶å›è°ƒ
  }

  // æ ¸å¿ƒæ–¹æ³•
  render() { /* æ¸²æŸ“çƒ­åŠ›å›¾ */ }
  update(newData) { /* æ›´æ–°æ•°æ® */ }
  resize() { /* å“åº”å¼è°ƒæ•´ */ }
  destroy() { /* é”€æ¯å®ä¾‹ */ }
}
```

#### ä½¿ç”¨ç¤ºä¾‹
```javascript
// æ ‡ç­¾è¯¦æƒ…é¡µä½¿ç”¨
const tagHeatmap = new StockHeatmap({
  container: '#tag-heatmap',
  data: stocksData,
  config: {
    height: 400,
    groupBy: 'sector',
    showLabels: true
  },
  callbacks: {
    onStockClick: (stock) => {
      window.open(`/stock-detail.html?symbol=${stock.symbol}`);
    },
    onSectorClick: (sector) => {
      window.location.href = `/tag-detail.html?tagId=sector_${sector}`;
    }
  }
});

// è¶‹åŠ¿æ¦œå•è¿·ä½ çƒ­åŠ›å›¾
const miniHeatmap = new StockHeatmap({
  container: '#trending-mini-heatmap',
  data: trendingStocks,
  config: {
    height: 200,
    showLabels: false,
    groupBy: 'none' // ä¸åˆ†ç»„ï¼Œç›´æ¥æ˜¾ç¤ºè‚¡ç¥¨
  }
});
```

### 2.2 HeatmapRenderer æ¸²æŸ“å¼•æ“

#### èŒè´£
- å°†å¤„ç†åçš„æ•°æ®è½¬æ¢ä¸ºå¯è§†åŒ–å…ƒç´ 
- ç®¡ç†SVG/Canvasæ¸²æŸ“é€»è¾‘
- å¤„ç†é¢œè‰²æ˜ å°„å’Œå°ºå¯¸è®¡ç®—
- å®ç°åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ

#### æ ¸å¿ƒç®—æ³•
```javascript
class HeatmapRenderer {
  constructor(container, config) {
    this.container = container;
    this.config = config;
    this.svg = null;
  }

  // Treemapå¸ƒå±€ç®—æ³•
  calculateLayout(data) {
    // ä½¿ç”¨D3.js treemapç®—æ³•æˆ–è‡ªå®šä¹‰å®ç°
    return d3.treemap()
      .size([this.config.width, this.config.height])
      .padding(2)
      (d3.hierarchy(data).sum(d => d.market_cap));
  }

  // é¢œè‰²æ˜ å°„
  getColor(changePercent) {
    const scale = d3.scaleLinear()
      .domain([-10, 0, 10])
      .range(['#ff4444', '#ffffff', '#44ff44']);
    return scale(changePercent);
  }

  // æ¸²æŸ“æ–¹æ³•
  render(layoutData) {
    // SVGæ¸²æŸ“é€»è¾‘
    this.svg = d3.select(this.container)
      .append('svg')
      .attr('width', this.config.width)
      .attr('height', this.config.height);

    // ç»˜åˆ¶çŸ©å½¢å’Œæ–‡æœ¬
    this.drawRectangles(layoutData);
    this.drawLabels(layoutData);
  }
}
```

### 2.3 DataProcessor æ•°æ®å¤„ç†å™¨

#### èŒè´£
- å°†APIè¿”å›çš„è‚¡ç¥¨æ•°æ®è½¬æ¢ä¸ºçƒ­åŠ›å›¾æ‰€éœ€æ ¼å¼
- å®ç°æ•°æ®åˆ†ç»„å’Œå±‚æ¬¡ç»“æ„æ„å»º
- å¤„ç†æ•°æ®éªŒè¯å’Œå¼‚å¸¸æƒ…å†µ

#### æ•°æ®è½¬æ¢æµç¨‹
```javascript
class DataProcessor {
  // ä¸»å¤„ç†æ–¹æ³•
  static processStockData(rawData, groupBy = 'sector') {
    // 1. æ•°æ®éªŒè¯å’Œæ¸…æ´—
    const cleanData = this.validateAndClean(rawData);
    
    // 2. æ ¹æ®åˆ†ç»„æ–¹å¼æ„å»ºå±‚æ¬¡ç»“æ„
    const hierarchyData = this.buildHierarchy(cleanData, groupBy);
    
    // 3. è®¡ç®—èšåˆæŒ‡æ ‡
    const enrichedData = this.calculateAggregates(hierarchyData);
    
    return enrichedData;
  }

  // æ„å»ºå±‚æ¬¡ç»“æ„
  static buildHierarchy(data, groupBy) {
    if (groupBy === 'none') {
      // ä¸åˆ†ç»„ï¼Œç›´æ¥è¿”å›æ‰å¹³ç»“æ„
      return {
        name: 'root',
        children: data.map(stock => ({
          name: stock.symbol,
          value: stock.market_cap,
          change: stock.change_percent,
          data: stock
        }))
      };
    }

    // æŒ‰è¡Œä¸šåˆ†ç»„
    const grouped = d3.group(data, d => d.sector || 'å…¶ä»–');
    return {
      name: 'root',
      children: Array.from(grouped, ([sector, stocks]) => ({
        name: sector,
        children: stocks.map(stock => ({
          name: stock.symbol,
          value: stock.market_cap,
          change: stock.change_percent,
          data: stock
        }))
      }))
    };
  }
}
```

---

## 3. é›†æˆæ–¹æ¡ˆè®¾è®¡

### 3.1 æ ‡ç­¾è¯¦æƒ…é¡µé›†æˆ

#### æ–‡ä»¶ä¿®æ”¹æ¸…å•
- `public/tag-detail.html`: æ·»åŠ çƒ­åŠ›å›¾å®¹å™¨
- `public/scripts/tag-detail.js`: é›†æˆçƒ­åŠ›å›¾ç»„ä»¶è°ƒç”¨
- `public/styles/tag-detail.css`: æ·»åŠ çƒ­åŠ›å›¾æ ·å¼

#### é›†æˆä»£ç ç¤ºä¾‹
```html
<!-- tag-detail.html ä¿®æ”¹ -->
<div class="tag-content">
  <!-- æ–°å¢çƒ­åŠ›å›¾å®¹å™¨ -->
  <div class="heatmap-section">
    <h3>æ¿å—çƒ­åŠ›å›¾</h3>
    <div id="tag-heatmap" class="heatmap-container"></div>
  </div>
  
  <!-- åŸæœ‰è‚¡ç¥¨åˆ—è¡¨ -->
  <div class="stocks-section">
    <h3>è‚¡ç¥¨åˆ—è¡¨</h3>
    <div id="stocks-container"></div>
  </div>
</div>
```

```javascript
// tag-detail.js ä¿®æ”¹
class TagDetailPage {
  async loadTagData(tagId) {
    try {
      const response = await fetch(`/api/stocks-by-tag?tag=${tagId}`);
      const data = await response.json();
      
      // æ¸²æŸ“è‚¡ç¥¨åˆ—è¡¨ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
      this.renderStocksList(data.stocks);
      
      // æ–°å¢ï¼šæ¸²æŸ“çƒ­åŠ›å›¾
      this.renderHeatmap(data.stocks);
      
    } catch (error) {
      console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
    }
  }

  renderHeatmap(stocks) {
    // åˆ›å»ºçƒ­åŠ›å›¾å®ä¾‹
    this.heatmap = new StockHeatmap({
      container: '#tag-heatmap',
      data: stocks,
      config: {
        height: 400,
        groupBy: 'sector'
      },
      callbacks: {
        onStockClick: (stock) => {
          window.open(`/stock-detail.html?symbol=${stock.symbol}`);
        }
      }
    });
  }
}
```

### 3.2 è¶‹åŠ¿æ¦œå•é¡µé›†æˆ

#### é›†æˆç­–ç•¥
- åœ¨æ¯ä¸ªæ¦œå•å¡ç‰‡ä¸­åµŒå…¥è¿·ä½ çƒ­åŠ›å›¾
- ä½¿ç”¨æ‡’åŠ è½½ä¼˜åŒ–æ€§èƒ½
- å®ç°çƒ­åŠ›å›¾ä¸æ¦œå•æ•°æ®çš„åŒæ­¥

```javascript
// trending.js ä¿®æ”¹
class TrendingPage {
  renderRankingCard(ranking, container) {
    const cardHTML = `
      <div class="ranking-card">
        <h3>${ranking.title}</h3>
        
        <!-- æ–°å¢è¿·ä½ çƒ­åŠ›å›¾ -->
        <div class="mini-heatmap-container" 
             id="heatmap-${ranking.id}"></div>
        
        <!-- åŸæœ‰è‚¡ç¥¨åˆ—è¡¨ -->
        <div class="stocks-list">
          ${this.renderStocksList(ranking.stocks)}
        </div>
      </div>
    `;
    
    container.innerHTML = cardHTML;
    
    // æ¸²æŸ“è¿·ä½ çƒ­åŠ›å›¾
    this.renderMiniHeatmap(ranking.stocks, `#heatmap-${ranking.id}`);
  }

  renderMiniHeatmap(stocks, container) {
    new StockHeatmap({
      container: container,
      data: stocks,
      config: {
        height: 150,
        showLabels: false,
        groupBy: 'none'
      }
    });
  }
}
```

### 3.3 çƒ­åŠ›å›¾ä¸­å¿ƒé¡µé¢

#### é¡µé¢ç»“æ„è®¾è®¡
```html
<!-- heatmap-center.html -->
<!DOCTYPE html>
<html>
<head>
  <title>çƒ­åŠ›å›¾ä¸­å¿ƒ - Stock Tag Explorer</title>
  <link rel="stylesheet" href="styles/heatmap-center.css">
</head>
<body>
  <div class="heatmap-center">
    <header>
      <h1>ğŸ“Š çƒ­åŠ›å›¾ä¸­å¿ƒ</h1>
      <p>æ¢ç´¢ä¸åŒç»´åº¦çš„å¸‚åœºçƒ­åŠ›å›¾è§†å›¾</p>
    </header>

    <main>
      <!-- å…¨æ™¯çƒ­åŠ›å›¾ -->
      <section class="heatmap-category">
        <h2>ğŸŒ å…¨æ™¯çƒ­åŠ›å›¾</h2>
        <div class="heatmap-grid">
          <a href="https://heatmap-dvrckt4gd-simon-pans-projects.vercel.app/" 
             class="heatmap-card featured">
            <h3>å®Œæ•´å¸‚åœºçƒ­åŠ›å›¾</h3>
            <p>æŸ¥çœ‹æ‰€æœ‰è‚¡ç¥¨çš„å®Œæ•´çƒ­åŠ›å›¾è§†å›¾</p>
          </a>
        </div>
      </section>

      <!-- è¡Œä¸šçƒ­åŠ›å›¾ -->
      <section class="heatmap-category">
        <h2>ğŸ­ è¡Œä¸šçƒ­åŠ›å›¾</h2>
        <div class="heatmap-grid" id="sector-heatmaps"></div>
      </section>

      <!-- æ ‡ç­¾çƒ­åŠ›å›¾ -->
      <section class="heatmap-category">
        <h2>ğŸ·ï¸ æ ‡ç­¾çƒ­åŠ›å›¾</h2>
        <div class="heatmap-grid" id="tag-heatmaps"></div>
      </section>

      <!-- æ¦œå•çƒ­åŠ›å›¾ -->
      <section class="heatmap-category">
        <h2>ğŸ“ˆ æ¦œå•çƒ­åŠ›å›¾</h2>
        <div class="heatmap-grid" id="ranking-heatmaps"></div>
      </section>
    </main>
  </div>

  <script src="scripts/heatmap-center.js"></script>
</body>
</html>
```

---

## 4. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 4.1 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### æ‡’åŠ è½½æœºåˆ¶
```javascript
class LazyHeatmapLoader {
  constructor() {
    this.observer = new IntersectionObserver(
      this.handleIntersection.bind(this),
      { threshold: 0.1 }
    );
  }

  observe(element) {
    this.observer.observe(element);
  }

  handleIntersection(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        this.loadHeatmap(entry.target);
        this.observer.unobserve(entry.target);
      }
    });
  }

  loadHeatmap(container) {
    const config = JSON.parse(container.dataset.heatmapConfig);
    new StockHeatmap(config);
  }
}
```

#### ç»„ä»¶å¤ç”¨æ± 
```javascript
class HeatmapPool {
  constructor(maxSize = 5) {
    this.pool = [];
    this.maxSize = maxSize;
  }

  acquire(config) {
    if (this.pool.length > 0) {
      const instance = this.pool.pop();
      instance.reconfigure(config);
      return instance;
    }
    return new StockHeatmap(config);
  }

  release(instance) {
    if (this.pool.length < this.maxSize) {
      instance.clear();
      this.pool.push(instance);
    } else {
      instance.destroy();
    }
  }
}
```

### 4.2 æ•°æ®ç¼“å­˜ç­–ç•¥

```javascript
class DataCache {
  constructor(ttl = 5 * 60 * 1000) { // 5åˆ†é’ŸTTL
    this.cache = new Map();
    this.ttl = ttl;
  }

  get(key) {
    const item = this.cache.get(key);
    if (!item) return null;
    
    if (Date.now() - item.timestamp > this.ttl) {
      this.cache.delete(key);
      return null;
    }
    
    return item.data;
  }

  set(key, data) {
    this.cache.set(key, {
      data,
      timestamp: Date.now()
    });
  }
}
```

---

## 5. é”™è¯¯å¤„ç†ä¸ç›‘æ§

### 5.1 é”™è¯¯å¤„ç†æœºåˆ¶

```javascript
class HeatmapErrorHandler {
  static handleRenderError(error, container) {
    console.error('çƒ­åŠ›å›¾æ¸²æŸ“å¤±è´¥:', error);
    
    // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
    container.innerHTML = `
      <div class="heatmap-error">
        <p>ğŸ“Š çƒ­åŠ›å›¾æš‚æ—¶æ— æ³•æ˜¾ç¤º</p>
        <button onclick="location.reload()">é‡è¯•</button>
      </div>
    `;
    
    // å‘é€é”™è¯¯æŠ¥å‘Š
    this.reportError(error);
  }

  static reportError(error) {
    // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
    if (window.analytics) {
      window.analytics.track('Heatmap Error', {
        error: error.message,
        stack: error.stack,
        timestamp: new Date().toISOString()
      });
    }
  }
}
```

### 5.2 æ€§èƒ½ç›‘æ§

```javascript
class PerformanceMonitor {
  static measureRenderTime(heatmapId, renderFunction) {
    const startTime = performance.now();
    
    return renderFunction().then(result => {
      const endTime = performance.now();
      const renderTime = endTime - startTime;
      
      // è®°å½•æ€§èƒ½æŒ‡æ ‡
      this.recordMetric('heatmap_render_time', renderTime, {
        heatmapId,
        timestamp: Date.now()
      });
      
      return result;
    });
  }

  static recordMetric(name, value, metadata) {
    if (window.analytics) {
      window.analytics.track('Performance Metric', {
        metric: name,
        value,
        ...metadata
      });
    }
  }
}
```

---

## 6. éƒ¨ç½²ä¸å‘å¸ƒç­–ç•¥

### 6.1 æ¸è¿›å¼å‘å¸ƒ

1. **é˜¶æ®µ1**: ä»…åœ¨æ ‡ç­¾è¯¦æƒ…é¡µå¯ç”¨çƒ­åŠ›å›¾
2. **é˜¶æ®µ2**: åœ¨è¶‹åŠ¿æ¦œå•é¡µæ·»åŠ è¿·ä½ çƒ­åŠ›å›¾
3. **é˜¶æ®µ3**: å‘å¸ƒçƒ­åŠ›å›¾ä¸­å¿ƒé¡µé¢
4. **é˜¶æ®µ4**: å¯ç”¨æ‰€æœ‰äº¤äº’åŠŸèƒ½

### 6.2 åŠŸèƒ½å¼€å…³

```javascript
const FeatureFlags = {
  HEATMAP_IN_TAG_DETAIL: true,
  HEATMAP_IN_TRENDING: false,
  HEATMAP_CENTER_PAGE: false,
  HEATMAP_INTERACTIONS: false
};

// ä½¿ç”¨ç¤ºä¾‹
if (FeatureFlags.HEATMAP_IN_TAG_DETAIL) {
  this.renderHeatmap(stocks);
}
```

### 6.3 å›æ»šç­–ç•¥

- ä¿æŒåŸæœ‰åŠŸèƒ½å®Œå…¨ç‹¬ç«‹
- çƒ­åŠ›å›¾ç»„ä»¶å¼‚å¸¸ä¸å½±å“ä¸»è¦åŠŸèƒ½
- æä¾›ä¸€é”®ç¦ç”¨çƒ­åŠ›å›¾çš„å¼€å…³

---

## 7. æµ‹è¯•ç­–ç•¥

### 7.1 å•å…ƒæµ‹è¯•

```javascript
// æµ‹è¯•æ•°æ®å¤„ç†å™¨
describe('DataProcessor', () => {
  test('should process stock data correctly', () => {
    const rawData = [/* æµ‹è¯•æ•°æ® */];
    const processed = DataProcessor.processStockData(rawData);
    
    expect(processed).toHaveProperty('name', 'root');
    expect(processed.children).toHaveLength(/* æœŸæœ›é•¿åº¦ */);
  });
});

// æµ‹è¯•çƒ­åŠ›å›¾ç»„ä»¶
describe('StockHeatmap', () => {
  test('should render without errors', () => {
    const container = document.createElement('div');
    const heatmap = new StockHeatmap({
      container,
      data: mockStockData
    });
    
    expect(() => heatmap.render()).not.toThrow();
  });
});
```

### 7.2 é›†æˆæµ‹è¯•

```javascript
// æµ‹è¯•é¡µé¢é›†æˆ
describe('Tag Detail Page Integration', () => {
  test('should load heatmap when stocks data is available', async () => {
    // æ¨¡æ‹ŸAPIå“åº”
    fetchMock.mockResponseOnce(JSON.stringify({
      stocks: mockStockData
    }));
    
    const page = new TagDetailPage();
    await page.loadTagData('test-tag');
    
    // éªŒè¯çƒ­åŠ›å›¾æ˜¯å¦æ¸²æŸ“
    const heatmapContainer = document.querySelector('#tag-heatmap');
    expect(heatmapContainer.children.length).toBeGreaterThan(0);
  });
});
```

### 7.3 æ€§èƒ½æµ‹è¯•

```javascript
// æ€§èƒ½åŸºå‡†æµ‹è¯•
describe('Performance Tests', () => {
  test('heatmap should render within 500ms', async () => {
    const startTime = performance.now();
    
    const heatmap = new StockHeatmap({
      container: '#test-container',
      data: largeStockDataset
    });
    
    await heatmap.render();
    
    const endTime = performance.now();
    expect(endTime - startTime).toBeLessThan(500);
  });
});
```

---

## 8. ç»´æŠ¤ä¸æ‰©å±•

### 8.1 ä»£ç ç»„ç»‡ç»“æ„

```
public/
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ heatmap/
â”‚   â”‚   â”œâ”€â”€ StockHeatmap.js          # ä¸»ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ HeatmapRenderer.js       # æ¸²æŸ“å¼•æ“
â”‚   â”‚   â”œâ”€â”€ DataProcessor.js         # æ•°æ®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ InteractionHandler.js    # äº¤äº’æ§åˆ¶
â”‚   â”‚   â””â”€â”€ utils.js                 # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ tag-detail-enhanced.js   # å¢å¼ºçš„æ ‡ç­¾è¯¦æƒ…é¡µ
â”‚   â”‚   â”œâ”€â”€ trending-enhanced.js     # å¢å¼ºçš„è¶‹åŠ¿æ¦œå•é¡µ
â”‚   â”‚   â””â”€â”€ heatmap-center.js        # çƒ­åŠ›å›¾ä¸­å¿ƒé¡µ
â”‚   â””â”€â”€ shared/
â”‚       â”œâ”€â”€ FeatureFlags.js          # åŠŸèƒ½å¼€å…³
â”‚       â”œâ”€â”€ ErrorHandler.js          # é”™è¯¯å¤„ç†
â”‚       â””â”€â”€ PerformanceMonitor.js    # æ€§èƒ½ç›‘æ§
â”œâ”€â”€ styles/
â”‚   â”œâ”€â”€ heatmap/
â”‚   â”‚   â”œâ”€â”€ heatmap-core.css         # æ ¸å¿ƒæ ·å¼
â”‚   â”‚   â”œâ”€â”€ heatmap-responsive.css   # å“åº”å¼æ ·å¼
â”‚   â”‚   â””â”€â”€ heatmap-themes.css       # ä¸»é¢˜æ ·å¼
â”‚   â””â”€â”€ pages/
â”‚       â”œâ”€â”€ tag-detail-enhanced.css
â”‚       â”œâ”€â”€ trending-enhanced.css
â”‚       â””â”€â”€ heatmap-center.css
â””â”€â”€ heatmap-center.html              # çƒ­åŠ›å›¾ä¸­å¿ƒé¡µé¢
```

### 8.2 æ‰©å±•æ¥å£è®¾è®¡

```javascript
// æ’ä»¶ç³»ç»Ÿ
class HeatmapPlugin {
  constructor(name, config) {
    this.name = name;
    this.config = config;
  }

  // ç”Ÿå‘½å‘¨æœŸé’©å­
  beforeRender(data) { return data; }
  afterRender(element) { /* åå¤„ç† */ }
  onInteraction(event) { /* äº¤äº’å¤„ç† */ }
}

// ä¸»é¢˜ç³»ç»Ÿ
class HeatmapTheme {
  constructor(name, colors, styles) {
    this.name = name;
    this.colors = colors;
    this.styles = styles;
  }

  apply(renderer) {
    renderer.setColorScheme(this.colors);
    renderer.setStyles(this.styles);
  }
}
```

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ä¸‹ä¸€æ­¥**: å¼€å§‹å¼€å‘å®æ–½æŒ‡å—ç¼–å†™