# 集成式热力图体验 - 产品需求文档 (PRD)

**文档版本**: v1.0  
**负责人**: PM-Core  
**创建日期**: 2025年1月30日  
**项目代号**: HeatmapMatrix

---

## 1. 项目愿景 (Vision)

将"股票热力图"从一个孤立的数据可视化工具，升级为一个**深度集成**在整个美股数据探索旅程中的**通用视觉分析组件**。通过在关键页面嵌入上下文相关的热力图，并在热力图中提供反向导航，构建一个**无缝、互联、可深度探索**的数据产品矩阵，让用户能够以最直观的方式，在"宏观板块"和"微观个股"之间自由穿梭。

### 核心价值主张
- **视觉化洞察**: 将纯列表数据转化为直观的视觉热力图，快速把握市场情绪
- **无缝导航**: 在热力图、标签详情、趋势榜单之间建立双向链接，消除探索断点
- **统一体验**: 构建一致的数据产品矩阵，提升用户粘性和探索深度

---

## 2. 目标用户 (Target Audience)

### 核心用户
- **现有用户**: 标签广场和趋势榜单的活跃用户
- **潜在用户**: 需要快速市场概览的投资者和分析师

### 用户痛点分析
1. **视觉化缺失**: 纯列表数据不够直观，难以快速把握板块整体表现
2. **探索断点**: 在热力图中发现机会后，需要手动切换应用进行深度研究
3. **入口分散**: 缺乏统一入口探索不同维度的热力图视图
4. **上下文丢失**: 各应用间缺乏关联，用户探索路径容易中断

---

## 3. 核心功能规划 (Features Roadmap)

### P0 功能 (MVP - 最高优先级)
**目标**: 实现热力图组件的**单向集成**，在核心页面中增加视觉洞察力

#### 3.1 可复用的热力图组件
**用户故事**: 作为开发者，我需要将现有热力图代码重构为可配置、可嵌入的JavaScript组件

**功能需求**:
- 组件接收股票数据数组作为输入
- 在指定HTML容器中进行渲染
- 自动完成"数据分组 → 树状结构转换 → 渲染"流程
- 股票方块面积由`market_cap`决定，颜色由`change_percent`决定
- 支持响应式布局，适配不同容器尺寸

**技术规格**:
```javascript
// 组件API设计
const heatmap = new StockHeatmap({
  container: '#heatmap-container',
  data: stocksArray,
  config: {
    width: 'auto',
    height: 400,
    colorScheme: 'redGreen',
    showLabels: true
  }
});
```

#### 3.2 标签详情页集成热力图
**用户故事**: 当我访问"中盘股"或"医疗保健"标签详情页时，希望在股票列表上方看到该标签专属的热力图

**功能需求**:
- 在`tag-detail.html`页面增加热力图容器
- `tag-detail.js`获取完整股票列表后调用热力图组件
- 热力图显示该标签下所有股票的市值分布和涨跌情况
- 支持热力图与列表数据的同步更新

#### 3.3 趋势榜单页集成热力图
**用户故事**: 在趋势榜单页面看到"涨幅榜"时，希望同时看到由上榜股票构成的迷你热力图

**功能需求**:
- 在`trending.html`每个榜单卡片内增加迷你热力图容器
- `trending.js`为每个榜单获取数据后渲染对应的迷你热力图
- 迷你热力图尺寸优化，适配榜单卡片布局
- 支持多个热力图同时渲染的性能优化

---

### P1 功能 (第二优先级)
**目标**: 实现**双向导航**与**中央入口**，构建产品矩阵闭环

#### 3.4 热力图增加反向链接
**用户故事**: 在任何热力图中看到感兴趣的行业板块或个股时，希望能直接点击跳转到对应详情页

**功能需求**:
- 为热力图组件增加点击事件监听
- 点击行业板块跳转到`/tag-detail.html?tagId=sector_[行业名]`
- 点击个股在新标签页打开个股详情页
- 提供hover提示，显示可点击元素的跳转目标

#### 3.5 热力图汇总页面
**用户故事**: 希望有一个"热力图中心"，方便访问不同维度的所有热力图

**功能需求**:
- 创建`heatmap-center.html`页面
- 提供以下入口：
  - **全景热力图**: 链接到独立热力图应用
  - **核心行业热力图**: 动态生成各行业热力图链接
  - **核心标签热力图**: 重要标签（大盘股、高ROE等）的热力图链接
  - **趋势榜单热力图**: 各榜单的热力图视图

---

## 4. 用户体验设计 (UX Design)

### 4.1 视觉设计原则
- **一致性**: 所有热力图使用统一的颜色方案和交互模式
- **层次性**: 主页面热力图突出显示，迷你热力图作为辅助信息
- **响应性**: 适配桌面和移动端的不同屏幕尺寸

### 4.2 交互设计
- **渐进式披露**: 从概览热力图到详细列表的自然过渡
- **上下文保持**: 跳转时保持用户的探索上下文
- **快速反馈**: hover和点击提供即时的视觉反馈

### 4.3 信息架构
```
标签广场 (index.html)
├── 各标签卡片
│   └── 点击 → 标签详情页 (tag-detail.html)
│       ├── 标签专属热力图
│       └── 股票列表
│
趋势榜单 (trending.html)
├── 各榜单卡片
│   ├── 迷你热力图
│   └── 股票列表
│
热力图中心 (heatmap-center.html)
├── 全景热力图入口
├── 行业热力图导航
├── 标签热力图导航
└── 榜单热力图导航
```

---

## 5. 技术架构 (Technical Architecture)

### 5.1 技术栈
- **主应用**: 保持现有技术栈 (原生 HTML/CSS/JS, Vercel API)
- **热力图组件**: 基于现有热力图库 (ECharts/D3.js) 封装
- **数据流**: 复用现有API，无需新建接口

### 5.2 代码整合策略
1. **组件化重构**: 将`Heatmap-pro`核心逻辑重构为可复用组件
2. **渐进式集成**: 先实现基础集成，再增加高级功能
3. **性能优化**: 实现懒加载和组件复用机制

### 5.3 API依赖
- **无需新建API**: 复用现有`/api/stocks-by-tag`、`/api/trending`、`/api/tags`
- **数据传递**: 前端获取列表数据后直接传递给热力图组件
- **缓存策略**: 实现客户端数据缓存，减少重复请求

---

## 6. 风险评估与缓解策略

### 6.1 性能风险
**风险**: 多个热力图同时渲染可能影响页面性能
**缓解策略**:
- 实现懒加载机制，只渲染可视区域的热力图
- 优化热力图组件代码，减少DOM操作
- 使用Web Workers处理复杂数据计算

### 6.2 用户体验风险
**风险**: 嵌入热力图可能让页面显得拥挤
**缓解策略**:
- 精心设计迷你热力图的信息密度
- 提供热力图显示/隐藏的用户控制选项
- 在原型阶段进行用户测试和反馈收集

### 6.3 技术风险
**风险**: 代码整合可能引入兼容性问题
**缓解策略**:
- 采用渐进式集成，分阶段验证功能
- 建立完善的测试覆盖，包括单元测试和集成测试
- 保持现有功能的向后兼容性

---

## 7. 项目时间线 (Timeline)

### Phase 1: MVP开发 (5-7天)
- **Day 1-2**: 热力图组件化重构
- **Day 3-4**: 标签详情页集成
- **Day 5-6**: 趋势榜单页集成
- **Day 7**: 测试与优化

### Phase 2: 功能增强 (3-4天)
- **Day 8-9**: 热力图点击跳转功能
- **Day 10-11**: 热力图汇总页面开发
- **Day 12**: 整体联调测试

### Phase 3: 优化与发布 (2-3天)
- **Day 13-14**: 性能优化和用户体验调优
- **Day 15**: 生产环境部署和监控

---

## 8. 成功指标 (Success Metrics)

### 8.1 用户参与度指标
- **页面停留时间**: 标签详情页和趋势榜单页停留时间提升30%
- **页面跳转率**: 热力图点击跳转率达到15%以上
- **探索深度**: 用户平均访问页面数增加25%

### 8.2 功能使用指标
- **热力图交互率**: 热力图hover和点击事件触发率
- **汇总页访问量**: 热力图中心页面的独立访问量
- **跨应用导航**: 从热力图到其他页面的导航成功率

### 8.3 技术性能指标
- **页面加载时间**: 集成热力图后页面加载时间增加不超过20%
- **渲染性能**: 热力图渲染时间控制在500ms以内
- **错误率**: 热力图相关功能错误率低于1%

---

## 9. 后续规划 (Future Roadmap)

### 短期优化 (1-2个月)
- 基于用户反馈优化热力图交互体验
- 增加更多自定义配置选项
- 实现热力图数据的实时更新

### 中期扩展 (3-6个月)
- 支持更多数据维度的热力图视图
- 集成机器学习算法，提供智能推荐
- 开发移动端专属的热力图体验

### 长期愿景 (6-12个月)
- 构建完整的数据可视化平台
- 支持用户自定义热力图配置
- 集成更多外部数据源和分析工具

---

**文档状态**: ✅ 已完成  
**下一步**: 开始技术架构设计文档编写